{
    "name": "Social Media AI + Kling Video (v10)",
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "social-media",
                "responseMode": "responseNode",
                "options": {}
            },
            "id": "webhook-trigger",
            "name": "Webhook",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                0,
                300
            ]
        },
        {
            "parameters": {
                "promptType": "define",
                "text": "=Sen profesyonel bir sosyal medya uzmanısın. \nŞu konu hakkında Türkçe, yaratıcı ve emojili bir sosyal medya caption yaz: {{ $json.body.content }}\n\nSADECE caption metnini döndür, başka açıklama yapma.",
                "options": {}
            },
            "id": "gemini-agent",
            "name": "Gemini AI Agent",
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 2.2,
            "position": [
                300,
                100
            ]
        },
        {
            "parameters": {
                "options": {}
            },
            "id": "gemini-model",
            "name": "Google Gemini Sohbet Modeli",
            "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
            "typeVersion": 1,
            "position": [
                300,
                260
            ],
            "credentials": {
                "googlePalmApi": {
                    "id": "PIRgIJn69sHnNuNU",
                    "name": "Google Gemini(PaLM) Api account 3"
                }
            }
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://queue.fal.run/fal-ai/kling-video/v1.6/standard/text-to-video",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "Authorization",
                            "value": "Key 5b1a53fd-1e3c-4a3b-ba12-1608f4e74ff1:fdc5e07aa0fcc314647f79faeb1b260c46deba56506f2a4a622cc4915b9759ae"
                        },
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"prompt\": \"{{ $('Webhook').first().json.body.content }}\",\n  \"duration\": \"5\",\n  \"aspect_ratio\": \"9:16\"\n}",
                "options": {}
            },
            "id": "fal-submit",
            "name": "Kling Video Submit",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                300,
                450
            ]
        },
        {
            "parameters": {
                "amount": 10
            },
            "id": "wait-node",
            "name": "Wait 10s",
            "type": "n8n-nodes-base.wait",
            "typeVersion": 1,
            "position": [
                500,
                450
            ]
        },
        {
            "parameters": {
                "url": "=https://queue.fal.run/fal-ai/kling-video/v1.6/standard/text-to-video/requests/{{ $node[\"Kling Video Submit\"].json.request_id }}/status",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "Authorization",
                            "value": "Key 5b1a53fd-1e3c-4a3b-ba12-1608f4e74ff1:fdc5e07aa0fcc314647f79faeb1b260c46deba56506f2a4a622cc4915b9759ae"
                        }
                    ]
                },
                "options": {}
            },
            "id": "fal-status",
            "name": "Kling Video Status",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                700,
                450
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "string": [
                        {
                            "value1": "={{ $json.status }}",
                            "value2": "COMPLETED"
                        }
                    ]
                }
            },
            "id": "is-completed",
            "name": "Finished?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                900,
                450
            ]
        },
        {
            "parameters": {
                "mode": "combine",
                "combineBy": "combineByPosition",
                "options": {}
            },
            "id": "merge-results",
            "name": "Sonuçları Birleştir",
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3,
            "position": [
                1150,
                300
            ]
        },
        {
            "parameters": {
                "jsCode": "const caption = $node[\"Gemini AI Agent\"].json[\"output\"];\nconst videoUrl = $node[\"Kling Video Status\"].json[\"response\"] ? $node[\"Kling Video Status\"].json[\"response\"][\"video\"][\"url\"] : $node[\"Kling Video Status\"].json[\"video\"][\"url\"];\nconst autoPublish = $('Webhook').first().json.body.autoPublish || false;\n\nreturn [{\n  json: {\n    caption: caption,\n    videoUrl: videoUrl,\n    autoPublish: autoPublish\n  }\n}];"
            },
            "id": "parse-code",
            "name": "Verileri Ayrıştır",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                1350,
                300
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "boolean": [
                        {
                            "value1": "={{ $json.autoPublish }}",
                            "value2": true
                        }
                    ]
                }
            },
            "id": "check-auto",
            "name": "Otomatik Yayınla?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                1550,
                300
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://app.publer.com/api/v1/posts",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "Authorization",
                            "value": "Bearer 05759b05fa542536760046f3d8cf1172653b8b669ef12b34"
                        },
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"workspace_id\": \"697e4aafea173ea72d403dc3\",\n  \"account_ids\": [\"697e508edbc27c1bab467ca4\"],\n  \"text\": \"{{ $json.caption }}\",\n  \"media_urls\": [\"{{ $json.videoUrl }}\"]\n}",
                "options": {}
            },
            "id": "publer-post",
            "name": "Publer Publish",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                1750,
                200
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={\n  \"success\": true,\n  \"caption\": \"{{ $json.caption }}\",\n  \"videoUrl\": \"{{ $json.videoUrl }}\",\n  \"published\": {{ $json.autoPublish }}\n}"
            },
            "id": "final-response",
            "name": "Cevap",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                1950,
                300
            ]
        }
    ],
    "connections": {
        "Webhook": {
            "main": [
                [
                    {
                        "node": "Gemini AI Agent",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "Fal.ai Submit",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Gemini AI Agent": {
            "main": [
                [
                    {
                        "node": "merge-results",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Google Gemini Sohbet Modeli": {
            "ai_languageModel": [
                [
                    {
                        "node": "Gemini AI Agent",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        },
        "Kling Video Submit": {
            "main": [
                [
                    {
                        "node": "wait-node",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "wait-node": {
            "main": [
                [
                    {
                        "node": "fal-status",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "fal-status": {
            "main": [
                [
                    {
                        "node": "is-completed",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "is-completed": {
            "main": [
                [
                    {
                        "node": "merge-results",
                        "type": "main",
                        "index": 1
                    }
                ],
                [
                    {
                        "node": "wait-node",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "merge-results": {
            "main": [
                [
                    {
                        "node": "parse-code",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "parse-code": {
            "main": [
                [
                    {
                        "node": "check-auto",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "check-auto": {
            "main": [
                [
                    {
                        "node": "publer-post",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "final-response",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "publer-post": {
            "main": [
                [
                    {
                        "node": "final-response",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}